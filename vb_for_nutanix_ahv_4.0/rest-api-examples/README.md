Scripts in this folder will help you start using VB REST API. The best way to use REST API is to generate client automatically and then use this client without thinking about API at all. That is exactly what we do here

### Files/folders
What do we have in this folder:
* **python-client-generated** -- folder with autoamtically generated REST API client. You can regenerate it yourself if you want, instruction can be found below
* **vbn_4_client_wrapper.py** -- additional wrapper around autogenerated client. It makes work with API even smoother. It is used by every other script 
* **vbn_4_cpu_usage_graph.py** -- build a graph for CPU usage during last 7 days. You can easily adjust it to RAM & storage usage.
* **vbn_4_rpo_report.py** -- build a simple RPO report
* **vbn_4_start_job.py** -- script to start job. Can be useful is you want to have your own (external) job schedule by rule which is not supported by VB.
* **vbn_4_vms_in_jobs_report.py** -- build report with a VM protection table. Allows you to understand which VMs are portected by backup/snapshot and which are not. Also, allows to understand if VM is protected by multiple jobs. 
* **vbn_4_daily_session_report.py** -- daily mail report with all VB sessions. Sessions are split to 3 categories: jobs, restores and system sessions. 

### How to start using these scripts
Install the autogenerated client to be able to use it later
```
cd vb_for_nutanix_ahv_4.0/rest-api-examples/python-client-generated
sudo python3 setup.py install
```

Install dependencies (if needed)
```
sudo apt install python3-pip
pip install pandas matplotlib isodate requests smtplib dateutil argparse html
```

After that you can run any script with `--help` flag to get the list of arguments of a script
```
niko@some-lab:~/veeam-nutanix/vb_for_nutanix_ahv_4.0/rest-api-examples$ ./vbn_4_start_job.py --help

usage: vbn_4_start_job.py [-h] [-u USERNAME] [-p PASSWORD] [-a ADDRESS] [-j JOB] [-af ACTIVE_FULL]

optional arguments:
  -h, --help            show this help message and exit
  -u USERNAME, --username USERNAME
                        username to access backup appliance
  -p PASSWORD, --password PASSWORD
                        password to access backup appliance
  -a ADDRESS, --address ADDRESS
                        address of veeam backup appliance
  -j JOB, --job JOB     name of a job which you want to start
  -af ACTIVE_FULL, --active_full ACTIVE_FULL
```


### How to regenerate REST API client
This step is not required. We have it here in case you want to be sure the REST API client is not modified by third parties. 

To regenerate a client, go to swagger (https://your-backup-appliance-address/swagger/index.html) and copy spec file from this link:
![image](https://user-images.githubusercontent.com/4194526/218718371-bdabbbe6-c876-406d-a0d5-f02fa4ba4bf2.png)
It is important to download file from this link and not to use the same spec as swagger uses. Since swagger has issues supporting advanced json objects in URL, swagger spec is a bit simplified in comparison to the one from the link above. 

After that go to Swagger editor https://editor-next.swagger.io/. Here you can paste the spec and click "Generate CLient => Python". That's it.
![image](https://user-images.githubusercontent.com/4194526/218719403-643f4adc-d9d5-43a9-84a8-49f3e434d50a.png)
